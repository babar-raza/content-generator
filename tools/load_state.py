import sys
sys.path.append('tools')
from progress_tracker import load_state, initialize_state

# Sorted list of files from discovery
sorted_files = [
    "src\\__init__.py",
    "src\\agents\\__init__.py",
    "src\\agents\\agents_complete.py",
    "src\\agents\\base.py",
    "src\\agents\\code\\__init__.py",
    "src\\agents\\code\\api_validator.py",
    "src\\agents\\code\\code_extraction.py",
    "src\\agents\\code\\code_generation.py",
    "src\\agents\\code\\code_splitting.py",
    "src\\agents\\code\\code_validation.py",
    "src\\agents\\code\\license_injection.py",
    "src\\agents\\content\\__init__.py",
    "src\\agents\\content\\conclusion_writer.py",
    "src\\agents\\content\\content_assembly.py",
    "src\\agents\\content\\introduction_writer.py",
    "src\\agents\\content\\outline_creation.py",
    "src\\agents\\content\\section_writer.py",
    "src\\agents\\content\\supplementary_content.py",
    "src\\agents\\ingestion\\__init__.py",
    "src\\agents\\ingestion\\api_ingestion.py",
    "src\\agents\\ingestion\\blog_ingestion.py",
    "src\\agents\\ingestion\\docs_ingestion.py",
    "src\\agents\\ingestion\\kb_ingestion.py",
    "src\\agents\\ingestion\\tutorial_ingestion.py",
    "src\\agents\\publishing\\__init__.py",
    "src\\agents\\publishing\\file_writer.py",
    "src\\agents\\publishing\\frontmatter_enhanced.py",
    "src\\agents\\publishing\\gist_readme.py",
    "src\\agents\\publishing\\gist_upload.py",
    "src\\agents\\publishing\\link_validation.py",
    "src\\agents\\research\\__init__.py",
    "src\\agents\\research\\api_search.py",
    "src\\agents\\research\\blog_search.py",
    "src\\agents\\research\\competitor_analysis.py",
    "src\\agents\\research\\content_intelligence.py",
    "src\\agents\\research\\docs_search.py",
    "src\\agents\\research\\duplication_check.py",
    "src\\agents\\research\\kb_search.py",
    "src\\agents\\research\\topic_identification.py",
    "src\\agents\\research\\trends_research.py",
    "src\\agents\\research\\tutorial_search.py",
    "src\\agents\\seo\\__init__.py",
    "src\\agents\\seo\\keyword_extraction.py",
    "src\\agents\\seo\\keyword_injection.py",
    "src\\agents\\seo\\seo_metadata.py",
    "src\\agents\\support\\__init__.py",
    "src\\agents\\support\\error_recovery.py",
    "src\\agents\\support\\model_selection.py",
    "src\\agents\\support\\quality_gate.py",
    "src\\agents\\support\\validation.py",
    "src\\core\\__init__.py",
    "src\\core\\agent_base.py",
    "src\\core\\agent_scanner.py",
    "src\\core\\config.py",
    "src\\core\\config_validator.py",
    "src\\core\\contracts.py",
    "src\\core\\enhanced_config.py",
    "src\\core\\event_bus.py",
    "src\\core\\job_execution_engine.py",
    "src\\core\\mock_llm.py",
    "src\\core\\multi_template_manager.py",
    "src\\core\\ollama.py",
    "src\\core\\template_registry.py",
    "src\\core\\workflow_compiler.py",
    "src\\engine\\__init__.py",
    "src\\engine\\agent_tracker.py",
    "src\\engine\\aggregator.py",
    "src\\engine\\completeness_gate.py",
    "src\\engine\\context_merger.py",
    "src\\engine\\device\\__init__.py",
    "src\\engine\\device\\gpu_manager.py",
    "src\\engine\\engine.py",
    "src\\engine\\exceptions.py",
    "src\\engine\\executor.py",
    "src\\engine\\input_resolver.py",
    "src\\engine\\output_path_resolver.py",
    "src\\engine\\slug_service.py",
    "src\\engine\\unified_engine.py",
    "src\\initialization\\__init__.py",
    "src\\initialization\\integrated_init.py",
    "src\\main.py",
    "src\\mcp\\__init__.py",
    "src\\mcp\\adapter.py",
    "src\\mcp\\config_aware_executor.py",
    "src\\mcp\\contracts.py",
    "src\\mcp\\handlers.py",
    "src\\mcp\\protocol.py",
    "src\\mcp\\web_adapter.py",
    "src\\mesh\\__init__.py",
    "src\\mesh\\batch_aggregators.py",
    "src\\mesh\\cache\\__init__.py",
    "src\\mesh\\cache\\cache.py",
    "src\\mesh\\capability_registry.py",
    "src\\mesh\\mesh_observer.py",
    "src\\mesh\\negotiation.py",
    "src\\mesh\\runtime_async.py",
    "src\\mesh\\state_store.py",
    "src\\optimization\\__init__.py",
    "src\\optimization\\batch.py",
    "src\\optimization\\cache.py",
    "src\\optimization\\connection_pool.py",
    "src\\orchestration\\__init__.py",
    "src\\orchestration\\agent_scanner.py",
    "src\\orchestration\\auto_discover_agents.py",
    "src\\orchestration\\checkpoint_manager.py",
    "src\\orchestration\\dependency_resolver.py",
    "src\\orchestration\\enhanced_registry.py",
    "src\\orchestration\\execution_plan.py",
    "src\\orchestration\\fallback_engine.py",
    "src\\orchestration\\generate_agent_yaml.py",
    "src\\orchestration\\hot_reload.py",
    "src\\orchestration\\job_execution_engine.py",
    "src\\orchestration\\job_execution_engine_enhanced.py",
    "src\\orchestration\\job_state.py",
    "src\\orchestration\\job_storage.py",
    "src\\orchestration\\langgraph_executor.py",
    "src\\orchestration\\langgraph_state.py",
    "src\\orchestration\\monitor.py",
    "src\\orchestration\\ops_console.py",
    "src\\orchestration\\parallel_executor.py",
    "src\\orchestration\\production_execution_engine.py",
    "src\\orchestration\\workflow_compiler.py",
    "src\\orchestration\\workflow_state.py",
    "src\\realtime\\__init__.py",
    "src\\realtime\\job_control.py",
    "src\\realtime\\websocket.py",
    "src\\services\\__init__.py",
    "src\\services\\mcp_service.py",
    "src\\services\\model_router.py",
    "src\\services\\services.py",
    "src\\services\\vectorstore.py",
    "src\\utils\\__init__.py",
    "src\\utils\\citation_tracker.py",
    "src\\utils\\content_utils.py",
    "src\\utils\\dedup_utils.py",
    "src\\utils\\duplication_detector.py",
    "src\\utils\\json_repair.py",
    "src\\utils\\learning.py",
    "src\\utils\\mock_guard.py",
    "src\\utils\\model_helper.py",
    "src\\utils\\ollama_detector.py",
    "src\\utils\\path_utils.py",
    "src\\utils\\resilience.py",
    "src\\utils\\retry.py",
    "src\\utils\\simple_monitor.py",
    "src\\utils\\tone_utils.py",
    "src\\utils\\validators.py",
    "src\\utils\\workflow_utils.py",
    "src\\visualization\\__init__.py",
    "src\\visualization\\agent_flow_monitor.py",
    "src\\visualization\\monitor.py",
    "src\\visualization\\visual_api.py",
    "src\\visualization\\workflow_debugger.py",
    "src\\visualization\\workflow_visualizer.py",
    "src\\web\\__init__.py",
    "src\\web\\app.py",
    "src\\web\\connection_manager.py",
    "src\\web\\dependencies.py",
    "src\\web\\models.py",
    "src\\web\\routes\\__init__.py",
    "src\\web\\routes\\agents.py",
    "src\\web\\routes\\jobs.py",
    "src\\web\\routes\\mcp.py",
    "src\\web\\routes\\workflows.py",
    "src\\web\\websocket_handlers.py",
    "tests\\__init__.py",
    "tests\\conftest.py",
    "tests\\fixtures\\__init__.py",
    "tests\\fixtures\\conftest.py",
    "tests\\fixtures\\fakes.py",
    "tests\\fixtures\\mock_chromadb.py",
    "tests\\fixtures\\mock_responses.py",
    "tests\\integration\\__init__.py",
    "tests\\integration\\test_agent_contracts.py",
    "tests\\integration\\test_artifact_persistence.py",
    "tests\\integration\\test_artifact_write_failure.py",
    "tests\\integration\\test_checkpoint_recovery.py",
    "tests\\integration\\test_cli.py",
    "tests\\integration\\test_cli_and_api.py",
    "tests\\integration\\test_cli_web_parity.py",
    "tests\\integration\\test_config_behavior.py",
    "tests\\integration\\test_config_integration.py",
    "tests\\integration\\test_config_validation.py",
    "tests\\integration\\test_database_service.py",
    "tests\\integration\\test_fastapi.py",
    "tests\\integration\\test_fixes.py",
    "tests\\integration\\test_full_pipeline.py",
    "tests\\integration\\test_installation.py",
    "tests\\integration\\test_integration.py",
    "tests\\integration\\test_mcp_compliance.py",
    "tests\\integration\\test_mcp_integration.py",
    "tests\\integration\\test_ops_console.py",
    "tests\\integration\\test_parity.py",
    "tests\\integration\\test_production_engine.py",
    "tests\\integration\\test_production_execution.py",
    "tests\\integration\\test_requirements.py",
    "tests\\integration\\test_router_integration.py",
    "tests\\integration\\test_services.py",
    "tests\\integration\\test_services_comprehensive.py",
    "tests\\integration\\test_slug_generation.py",
    "tests\\integration\\test_system_integration.py",
    "tests\\integration\\test_template_golden.py",
    "tests\\integration\\test_template_registry.py",
    "tests\\integration\\test_unified_executor.py",
    "tests\\integration\\test_validation_edge_cases.py",
    "tests\\integration\\test_websocket_e2e.py",
    "tests\\integration\\test_workflow_engine.py",
    "tests\\performance\\__init__.py",
    "tests\\performance\\_perf_utils.py",
    "tests\\performance\\conftest.py",
    "tests\\performance\\test_optimization.py",
    "tests\\performance\\test_parallel_speedup.py",
    "tests\\performance\\test_perf_cli.py",
    "tests\\performance\\test_perf_core_ollama.py",
    "tests\\performance\\test_perf_engine.py",
    "tests\\performance\\test_perf_web.py",
    "tests\\performance\\test_tone_perf_usage.py",
    "tests\\unit\\__init__.py",
    "tests\\unit\\test_agents.py",
    "tests\\unit\\test_agents_contracts.py",
    "tests\\unit\\test_aggregator.py",
    "tests\\unit\\test_completeness_gate.py",
    "tests\\unit\\test_config.py",
    "tests\\unit\\test_core_and_utils.py",
    "tests\\unit\\test_engine.py",
    "tests\\unit\\test_engine_and_orchestrator.py",
    "tests\\unit\\test_event_bus.py",
    "tests\\unit\\test_gpu_manager.py",
    "tests\\unit\\test_imports_smoke.py",
    "tests\\unit\\test_json_repair.py",
    "tests\\unit\\test_mesh.py",
    "tests\\unit\\test_ollama.py",
    "tests\\unit\\test_output_path_resolver.py",
    "tests\\unit\\test_research_agents.py",
    "tests\\unit\\test_services.py",
    "tests\\unit\\test_slug_service.py",
    "tests\\unit\\test_uploaded_files.py",
    "tests\\unit\\test_utils.py",
    "tests\\unit\\test_validation.py",
    "tests\\web\\__init__.py",
    "tests\\web\\test_api.py",
    "tests\\web\\test_app_integration.py",
    "tests\\web\\test_dashboard_ui.py",
    "tests\\web\\test_ui_contracts.py",
    "tests\\web\\test_visualization.py",
    "tests\\web\\test_visualization_integration.py",
    "tests\\web\\test_websockets.py",
    "job_cli.py",
    "process_batch.py",
    "profile_system.py",
    "start_api.py",
    "start_web.py",
    "temp_discovery.py",
    "tests\\cli\\test_cli_integration.py",
    "tests\\core\\test_core_logic.py",
    "tests\\core\\test_event_bus.py",
    "tests\\core\\test_fixes.py",
    "tests\\core\\test_import.py",
    "tests\\core\\test_langgraph_parity.py",
    "tests\\core\\test_startup.py",
    "tests\\core\\test_validation_agents.py",
    "tests\\e2e\\test_blog_generation_e2e.py",
    "tests\\e2e\\test_full_job_happy_path.py",
    "tests\\engine\\test_aggregator.py",
    "tests\\engine\\test_completeness_gate.py",
    "tests\\engine\\test_engine_parity.py",
    "tests\\engine\\test_unified_engine.py",
    "tools\\api_catalog.py",
    "tools\\ast_guard.py",
    "tools\\ast_scan.py",
    "tools\\comment_updater.py",
    "tools\\config_concurrency_detect.py",
    "tools\\docstring_writer.py",
    "tools\\exception_io_detect.py",
    "tools\\langgraph_executor.py",
    "tools\\maintain.py",
    "tools\\perf_report.py",
    "tools\\perf_runner.py",
    "tools\\pre_deploy_check.py",
    "tools\\progress_tracker.py",
    "tools\\repo_scan.py",
    "tools\\test_refactor.py",
    "tools\\util_fs.py",
    "tools\\validate.py",
    "tools\\validate_imports.py",
    "tools\\validate_production.py",
    "tools\\validate_system.py",
    "tools\\verify_fix.py",
    "tools\\verify_hot_reload.py",
    "tools\\verify_hot_reload_full.py",
    "tools\\verify_parallel_execution.py",
    "tools\\verify_services.py",
    "tools\\verify_utils.py",
    "ucop_cli.py"
]

# Try to load existing state
state = load_state("tools/.docgen_state.json")

# Check if state exists and is not empty
if not state:
    # Initialize new state
    state = initialize_state(sorted_files, "tools/.docgen_discovery.hash", "tools/.docgen_state.json")
else:
    # Check discovery hash
    with open("tools/.docgen_discovery.hash", 'r') as f:
        current_hash = f.read().strip()
    expected_hash = "ba862db359ed7b1e948bed7865d5f2bf169bbba12f04cdefb84a54bfbf16f1b4"
    if current_hash != expected_hash:
        # Re-initialize
        state = initialize_state(sorted_files, "tools/.docgen_discovery.hash", "tools/.docgen_state.json")

print("State Summary:")
print(f"Queue length: {len(state.get('queue', []))}")
print(f"Done count: {len(state.get('done', []))}")
print(f"Skipped count: {len(state.get('skipped', []))}")
print(f"Total files in status: {len(state.get('status', {}))}")